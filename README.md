# RPTO Lead Manager CRM

A fully offline, standalone React + TypeScript + Material UI + Capacitor PWA application for managing leads for the Remote Pilot Training Organisation (RPTO).

## Features

- ✅ **Offline-First**: All data stored locally using Dexie.js (IndexedDB)
- ✅ **PWA Support**: Installable Progressive Web App with service worker
- ✅ **Mobile Ready**: Capacitor integration for Android and iOS
- ✅ **Full CRUD Operations**: Create, Read, Update, Delete leads
- ✅ **CSV Import/Export**: Bulk import leads and export filtered data
- ✅ **Advanced Filtering**: Filter by name, place, phone, status, and date
- ✅ **Date-Based Grouping**: Leads organized by Today, Yesterday, Last 7 Days, and Older
- ✅ **WhatsApp Integration**: Direct WhatsApp links with pre-filled messages
- ✅ **Greeting Messages**: Auto-generated greeting messages for converted leads
- ✅ **Responsive Design**: Material UI components with mobile-first approach

## Tech Stack

- **React 19** with TypeScript
- **Vite** - Build tool and dev server
- **Material UI (MUI)** - Component library
- **Dexie.js** - IndexedDB wrapper for local storage
- **Capacitor** - Native mobile app framework
- **Vite PWA Plugin** - Progressive Web App support

## Prerequisites

- Node.js 18+ and npm
- For mobile development:
  - Android Studio (for Android)
  - Xcode (for iOS, macOS only)

## Installation

1. Install dependencies:
```bash
npm install
```

2. Create PWA icons (optional but recommended):
   - Create `public/icons/icon-192x192.png` (192x192 pixels)
   - Create `public/icons/icon-512x512.png` (512x512 pixels)
   - These icons will be used for PWA installation

## Development

Start the development server:
```bash
npm run dev
```

The app will be available at `http://localhost:5173`

## Building for Production

Build the application:
```bash
npm run build
```

The production build will be in the `dist` directory.

Preview the production build:
```bash
npm run preview
```

## Mobile App Setup (Capacitor)

### Initial Setup

1. Add Android platform:
```bash
npx cap add android
```

2. Add iOS platform (macOS only):
```bash
npx cap add ios
```

### Building and Running

1. Build the web app:
```bash
npm run build
```

2. Sync the build to native platforms:
```bash
npx cap sync
```

3. Open in native IDE:
```bash
# Android
npx cap open android

# iOS (macOS only)
npx cap open ios
```

4. Run the app from Android Studio or Xcode

## Project Structure

```
src/
├── components/
│   ├── DashboardPage.tsx       # Main dashboard component
│   ├── LeadCard.tsx            # Individual lead card component
│   ├── LeadGroupHeader.tsx     # Date group header component
│   └── modals/
│       ├── AddLeadModal.tsx    # Add/Edit lead modal
│       ├── DeleteModal.tsx      # Delete confirmation modal
│       ├── ImportCSVModal.tsx  # CSV import modal
│       └── GreetingModal.tsx   # Greeting message modal
├── db/
│   └── localDB.ts              # Dexie database configuration and CRUD functions
├── hooks/
│   └── useLeads.ts             # Custom hook for lead management
├── theme/
│   └── theme.ts                # Material UI theme configuration
├── types/
│   └── lead.ts                 # TypeScript type definitions
├── utils/
│   ├── dateUtils.ts            # Date manipulation utilities
│   ├── csvUtils.ts            # CSV parsing and export utilities
│   └── whatsappUtils.ts       # WhatsApp integration utilities
├── App.tsx                     # Main app component
└── main.tsx                    # Application entry point
```

## Data Model

### Lead Schema

```typescript
interface Lead {
  id: string;                    // UUID generated by crypto.randomUUID()
  name: string;                  // Required
  age: string | number;          // Optional
  phone: string;                 // Required (for WhatsApp)
  email: string;                 // Optional
  place: string;                 // Required (City/Region)
  status: 'New' | 'Contacted' | 'Converted' | 'Lost';
  image_url: string;             // Profile picture or ID copy URL
  remarks: string;               // Contact notes
  created_at: string;            // ISO timestamp
}
```

## Features in Detail

### Filtering
- **Name**: Case-insensitive partial match
- **Place**: Case-insensitive partial match
- **Phone**: Numeric matching (non-digits removed)
- **Status**: Exact match dropdown
- **Date**: Filter by creation date (YYYY-MM-DD)

### CSV Import
- Supports CSV files with headers: name, age, phone, email, place, status, image_url, remarks
- Validates required fields (name, place)
- Auto-generates IDs and timestamps
- Sample CSV template available for download

### CSV Export
- Exports filtered leads to CSV
- Includes all lead fields with formatted dates
- Proper CSV escaping for special characters

### Date Grouping
Leads are automatically grouped by creation date:
- **Today**: Leads created today
- **Yesterday**: Leads created yesterday
- **Last 7 Days**: Leads created in the past 7 days (excluding today/yesterday)
- **Older**: All other leads

## PWA Features

- **Offline Support**: Service worker caches app assets
- **Installable**: Can be installed as a standalone app
- **Auto-update**: Service worker updates automatically
- **Logo Caching**: RPTO logo cached for offline use

## Browser Support

- Chrome/Edge (latest)
- Firefox (latest)
- Safari (latest)
- Mobile browsers (iOS Safari, Chrome Android)

## Troubleshooting

### IndexedDB Issues
If you encounter IndexedDB errors:
- Clear browser cache and storage
- Check browser console for specific errors
- Ensure browser supports IndexedDB

### Capacitor Build Issues
- Ensure you've run `npm run build` before `npx cap sync`
- Check that Android Studio/Xcode is properly installed
- Verify Capacitor configuration in `capacitor.config.ts`

### PWA Not Installing
- Ensure you're using HTTPS (or localhost for development)
- Check that manifest.json is properly configured
- Verify icons are present in `public/icons/`

## License

© 2025 Remote Pilot Training Organisation CRM. All rights reserved.
